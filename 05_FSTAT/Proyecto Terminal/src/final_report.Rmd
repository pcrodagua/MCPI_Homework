---
title: "Análisis Estadístico de Enfermedades en el Corazón"
author: "Pablo César Rodríguez Aguayo"
date: "Marzo 14, 2019*"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
```
<style>
body {
  text-align: justify
}
</style>

--------------------------------------------------------------------------------------------

# **Parte I**: Introducción

## Heart Disease UCI (Enfermedades del Corazón UCI)
Esta base de datos contiene 76 atributos, pero todos los experimentos publicados se refieren al uso de un subconjunto de 14 de ellos. En particular, la base de datos de Cleveland es la única que ha sido utilizada por los investigadores de Machine Learning hasta la fecha. El campo "objetivo" se refiere a la presencia de una enfermedad cardíaca en el paciente. Es un valor entero de 0 (sin presencia) a 4. Los experimentos con la base de datos de Cleveland se han concentrado en simplemente intentar distinguir la presencia (valores 1,2,3,4) de la ausencia (valor 0). Los nombres y números de seguridad social de los pacientes se eliminaron recientemente de la base de datos y se reemplazaron con valores ficticios.


## Problema Presentado
Dentro de la perspectiva social, sanitaria uno de los mayores retos que enfrentan las organizaciones de salud es la prestación de servicios los cuales permitan al paciente un costo bajo así como accesibilidad, con una calidad superior la cual garantice un diagnóstico objetivo. Un diagnóstico preciso comprende una toma de decisiones correcta la cual permita generar un diagnostico preciso para el paciente. Una decisión medica tomada de una forma no adecuada puede conducir a problemas mayores de salud donde cada vez se vuelven más costosos y difíciles de tratar, ya en última instancia pueden traer al paciente consecuencias desastrosas incluso llegando a la muerte. Habitualmente, las decisiones tomadas por el personal clínico a menudo son tomadas basándose en la intuición de los médicos y experiencia en lugar de las observaciones estadísticas de la información presentada, lo cual termina por llevar a errores de tratamiento, costos excesivos y efectos en la calidad de los servicios médicos de los pacientes.


## Significado del Diagnóstico 
El diagnóstico de enfermedad cardíaca se realiza mediante una combinación de signos clínicos y resultados de pruebas. Los tipos de pruebas que se realizarán se elegirán en función de lo que el médico cree que está pasando, que va desde los electrocardiogramas y las tomografías computarizadas (TC) cardiacas hasta las pruebas de sangre y las pruebas de esfuerzo con ejercicios.


## Alcance del Estudio
Para propositos de esta investigación, se pretende realizar un análsis exploratorio de los factores que influyen sobre las enfermedades cardiacas. Lo cual permtirá posteriormente aplicar diversas técnicas de minería de datos para descubrir patrones dentro de los datos que nos permitan obtener mediciones y descripciones de los datos a través de la estadística descriptiva.


## Análisis Exploratorio de Datos
El análisis exploratorio de datos permitirá resumir las características que rodean el fenómeno en cuestión. La importancia del análisis exploratorio permite proporcionar y definir la percepcion del conjunto de datos utilizado. Permtiendo definir los objetivos a través del análisis de los datos mediante resumenes numéricos los cuales se enfocan en el aspecto estadístico. De igual manera, permiten enfocarse en los objetivos de la investigacion a través de la delimitación de los datos no necesarios. 


## Recolección de Datos y Preprocesamiento
La recolección de datos y preprocesamiento estuvo a cargo de: 

1. Hungarian Institute of Cardiology. Budapest: Andras Janosi, M.D. 
2. University Hospital, Zurich, Switzerland: William Steinbrunn, M.D. 
3. University Hospital, Basel, Switzerland: Matthias Pfisterer, M.D. 
4. V.A. Medical Center, Long Beach and Cleveland Clinic Foundation: Robert Detrano, M.D., Ph.D.

Siendo donado por: David W. Aha (aha '@' ics.uci.edu) (714) 856-8779

Por lo que se desconocen los métodos de recolección y preprocesamiento empleados.




--------------------------------------------------------------------------------------------


# **Parte II**: Análisis Exploratorio

## Análisis de las Características

### Descripción
```{r description, echo=FALSE}
setwd("/home/ospcx/Proyects/MCPI_Homework/05_FSTAT/Proyecto Terminal/src/")
data <- read.csv(file = "../data/heart.csv", header = TRUE, sep = ",", stringsAsFactors=FALSE)
heart_data <- data.frame(data)
```
Dentro de las características del conjunto de datos, se presentan las siguientes: 

- **age:** Edad en años.
- **sex:** Sexo como variable dicotómica (1 = masculino, 0 = femenino)
- **cp:** Tipo de dolor en el pecho.
- **trestbps:** Presión arterial en reposo (en mmHg al ingresar en el hospital)
- **chol:** Colesterol sérico en mg/dl
- **fbs:** Azúcar en la sangre en ayunas >120mg/dl (1 = verdadero, 0 = falso)
- **restecg:** Resultados electrocardiográficos en reposo. 
- **thalach:** Ritmo Cardíaco Máximo Alcanzado
- **exang:**  Angina Inducida por el Ejercicio
- **oldpeak:** Depresión ST inducida por el ejercicio en relación con el descanso.
- **slope:** La pendiente del segmento pico del ejercicio ST.
- **ca:** Número de vasos principales (0-3) coloreados por fluoroscopia
- **thal:** 3 = normal, 6 = defecto fijo, 7 = defecto reversible
- **target:** Enfermo = 1, no enfermo = 0.

### Cabecera

```{r head, echo=FALSE, results='asis'}
kable(head(data), caption = 'Inicio del Conjunto de Datos')
```

### Cola

```{r tail, echo=FALSE, results='asis'}
kable(tail(data), caption = 'Final del Conjunto de Datos')
```

El conjunto de datos está conformado por 14 características y 303 observaciones.


## Máximos, Mínimos y Valores Atípicos 
Como se ha observado, el conjunto de datos tiene un número considerable de valores por lo que una de las metas es describir estas características y obtener una conclusión. El uso de máximos y mínimos permite el cálculo de otras medidas como el rango el cual se verá posteriormente. Además permite determinar los valores atípicos dentro del conjunto de datos, ya sean los valores atípicos menores o mayores.

```{r men_women_max, echo=FALSE, results='asis' }
# --- age --- 
women_age <- subset(heart_data, sex == 0)[c(1)]
men_age <- subset(heart_data, sex == 1)[c(1)]

# --- trestbps --- 
women_trestbps <- subset(heart_data, sex == 0)[c(4)]
men_trestbps <- subset(heart_data, sex == 1)[c(4)]

# --- chol --- 
women_chol <- subset(heart_data, sex == 0)[c(5)]
men_chol <- subset(heart_data, sex == 1)[c(5)]

# --- thalach --- 
women_thalach <- subset(heart_data, sex == 0)[c(8)]
men_thalach <- subset(heart_data, sex == 1)[c(8)]

# --- oldpeak --- 
women_oldpeak <- subset(heart_data, sex == 0)[c(10)]
men_oldpeak <- subset(heart_data, sex == 1)[c(10)]

```

### Máximos
Se define como el valor matemático mayor en el conjunto de datos.

```{r max, echo=FALSE, results='asis'}
max_vals_men <- c(max(men_age$age), max(men_trestbps$trestbps), max(men_chol$chol), max(men_thalach$thalach), max(men_oldpeak$oldpeak))
max_vals_women <- c(max(women_age$age), max(women_trestbps$trestbps), max(women_chol$chol), max(women_thalach$thalach), max(women_oldpeak$oldpeak))
max_vals_general <- c(max(heart_data$age), max(heart_data$trestbps), max(heart_data$chol), max(heart_data$thalach), max(heart_data$oldpeak))

data_gen <- cbind(max_vals_general ,max_vals_men, max_vals_women)
df.max_val <- data.frame(data_gen)
colnames(df.max_val) <- sex_ <- c('General', 'Hombre', 'Mujer')
rownames(df.max_val) <- c('Edad', 'Presión Arterial', 'Colesterol', 'Ritmo Cardíaco', 'Depresión ST')

kable(df.max_val, caption = 'Valores Máximos Obtenidos')
```

**Comentarios: ** Cabe destacar que de lo anterior visto, la _edad_ máxima es perteneciente a los hombres por un año. En cuanto a _presión arterial_, se puede ver que el valor mayor corresponde a una mujer tomando el valor de 200, siendo el máximo en hombres menor por 8 unidades. Así mismo pasa con el _colesterol_, siendo el valor máximo encontrado en el subconjunto de las mujeres tomando el valor de 564 y en hombres de 353. Dada la naturaleza aún no estudiada del colesterol, hasta este punto pudiera ser que el colesterol máximo encontrado es un valor atípico. Respecto al _ritmo cardiaco_, se puede apreciar que es mayor en los hombres con un valor de 202, mientras que en mujeres es 10 unidades menor. Por último, se puede ver que en la depresión post-entrenamiento es ligeramente mayor en mujeres por 0.6, tomando las mujeres el valor máximo nuevamente. Hasta este punto, basandose en los aspectos analizados se puede ver que las mujeres tienen los valores máximos en tres de cinco características analizadas, siendo una de ellas un probable valor atípico.

### Mínimos
Se define como el valor matemático menor en el conjunto de datos.

```{r min, echo=FALSE, results='asis'}
min_vals_men <- c(min(men_age$age), min(men_trestbps$trestbps), min(men_chol$chol), min(men_thalach$thalach), min(men_oldpeak$oldpeak))
min_vals_women <- c(min(women_age$age), min(women_trestbps$trestbps), min(women_chol$chol), min(women_thalach$thalach), min(women_oldpeak$oldpeak))
min_vals_general <- c(min(heart_data$age), min(heart_data$trestbps), min(heart_data$chol), min(heart_data$thalach), min(heart_data$oldpeak))

data_gen <- cbind(min_vals_general ,min_vals_men, min_vals_women)
df.min_val <- data.frame(data_gen)
colnames(df.min_val) <- sex_ <- c('General', 'Hombre', 'Mujer')
rownames(df.min_val) <- c('Edad', 'Presión Arterial', 'Colesterol', 'Ritmo Cardíaco', 'Depresión ST')

kable(df.min_val, caption = 'Valores Mínimos Obtenidos')
```

**Comentarios: ** De acuerdo a los valores mínimos, respecto a la _edad_ podemos decir que siendo el valor mínimo perteneciente a un hombre con 29 años y el valor máximo a un hombre igualmente, se puede decir que es más ámplio el rango de edades en los varones. Para este caso, la _presión arterial_, presentó un caso con un valor mínimo de 94 tanto para hombres como para mujeres. Para el _colesterol_ se puede ver que el valor mínimo se encuentra en el subconjunto de los hombres, con un valor de 126, mientras que las mujeres poseen un valor mínimo de 141. Para el caso del _ritmo cardiaco_, la presencia en hombres es con un valor mínimo de 71, mientras que en el subconjunto de las mujeres es de 96. Por último, se puede ver que para la depresión post-entrenamiento, el valor para todos es 0, lo cual puede ser un posible valor atípico encontrado dentro del conjunto de datos.

## Cuartiles, Percentiles y Rango

### Cuartiles
En términos generales, los cuartiles dividen el conjunto de datos en cuatro partes iguales, con observaciones sobre el tercer cuartil que constituyen el cuarto superior de los datos del conjunto, siendo el segundo cuartil idéntico a la mediana, y el primer cuartil separado al cuarto más bajo de los tres cuartos superiores. Los valores comunmente esperados se encuentran entre el primer cuartil y el tercero, mientras que los valores atípicos se encuentran ya sea por encima del tercer cuartil o bien por debajo del primer cuartil.

### Percentiles
Del mismo modo, un conjunto de datos se puede dividir aún más finamente usando percentiles; el percentil 99 separa el 1% más alto del 99% inferior, y así sucesivamente. A menos que el número de observaciones sea múltiplo de 100. 

**Nota** El percentil en la posición 50, el segundo cuartil, la mediana y el quinto decil son el mismo valor el cual está representado mediante la siguiente fórmula.
$$P_{50} =  \tilde{x} = Q_2 = D_5$$


## Valores Atípicos
Se definen como los valores mucho mayores o menores que los demás valores en el conjunto de datos. O bien, se puede definir como el valor que radica por fuera del conjunto de datos establecido las cuales se distinguen por su distancia a los valores normales.

### Regla del Pulgar
Siendo una práctica común la _regla del pulgar_, la cual consiste en designar un valor atípico en base a la experiencia obtenida. Para esto, los valores atípicos se calculan mediante dos fórmulas. La primera permite calcular los valores atípicos mínimos, es decir los valores que están por debajo de lo esperado, para esto se emplea la siguiente fórmula: 

$$V_{ai} =  Q_1 - 1.5*IQR$$
Donde: 

- $V_{ai}$ son los valores atípicos inferiores.
- $Q_1$ es el valor del cuartil 1.
- $IQR$ es el valor intercuartil.

Mientras que para calcular los valores atípicos por encima de lo esperado, se emplea la siguiente fórmula:

$$V_{as} =  Q_3 + 1.5*IQR$$

Donde: 

- $V_{as}$ son los valore atípicos superiores.
- $Q_3$ es el valor del cuartil 3.
- $IQR$ es el valor intercuartil.

Si bien estas medidas no son utilizadas como la forma adecuada para calcular los valores atípicos, dentro de la industrial son ampliamente aceptadas. Sin embargo, estos métodos solo son usados si el analista de datos es considerado de grado midlevel o senior. Para este caso se utilizará el diagrama de caja para ver la distribución de los datos. 

### Rango
El rango permite conocer la diferencia entre el valor máximo y mínimo de la característica seleccionada. Esta medida es considerada como medida de dispersión y permite conocer el intervalo que se haya entre la distribución. Se calcula mediante la siguiente fórmula:

$$R_{var} = max(x) - min(x)$$

### Conlusiones Generales
A continuación se realizará un análisis para las características: edad y presión arterial. Mostrando los valores mínimos, máximo, rango segundo cuartil y un breve análisis de los datos obtenidos.

#### Edad

```{r sum_age_women, echo=FALSE, results='asis'}
boxplot(women_age$age,
  main = "Edad en Mujeres",
  xlab = "Edad",
  ylab = "Mujeres",
  col = "red",
  border = "gray",
  horizontal = TRUE,
  notch = TRUE
)
```

**Notas:** De acuerdo a la gráfica anterior se puede apreciar que el valor mínimo está en 34 mientras que su máximo es de 76, con un rango de 42. A su vez se puede apreciar que no hay valores atípicos y que su segundo cuartil es de 57. 


```{r sum_age_men, echo=FALSE, results='asis'}
boxplot(men_age$age,
  main = "Edad en Hombres",
  xlab = "Edad",
  ylab = "Hombres",
  col = "blue",
  border = "gray",
  horizontal = TRUE,
  notch = TRUE
)
```

**Notas:** Para el conjunto de los hombres se puede apreciar un valor mínimo de 29 y un máximo de 77, donde su rango es de 48. A su vez se puede apreciar que no hay valores atípicos y que su segundo cuartil es de 54, esto debido al mayor rango de los datos. 


```{r sum_age_pac, echo=FALSE, results='asis'}
boxplot(heart_data$age,
  main = "Edad en Pacientes",
  xlab = "Edad",
  ylab = "General",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```

**Notas:** Para el conjunto general se puede apreciar un valor mínimo de 29 y un máximo de 77, donde su rango es de 42. A su vez se puede apreciar que no hay valores atípicos y que su segundo cuartil es de 55, debido a la suma de ambos conjuntos y. 


#### Presión Arterial
```{r sum_trestbps_women, echo=FALSE, results='asis'}
# --- trestbps --- 
boxplot(women_trestbps$trestbps,
  main = "Presión Arterial en Mujeres",
  xlab = "Presión Arterial",
  ylab = "Mujeres",
  col = "red",
  border = "gray",
  horizontal = TRUE,
  notch = TRUE
)
```

**Notas:** En el subconjunto de las mujeres se puede apreciar un valor mínimo de 94 y un máximo de 200, donde su rango es de 106. Presentando valores atípicos despues del tercer quartil y con segundo cuartil de 131 indicando la mitad de los datos. 

```{r sum_trestbps_men, echo=FALSE, results='asis'}
# --- trestbps --- 
boxplot(men_trestbps$trestbps,
  main = "Presión Arterial en Hombres",
  xlab = "Presión Arterial",
  ylab = "Hombres",
  col = "blue",
  border = "gray",
  horizontal = TRUE,
  notch = TRUE
)
```

**Notas:** En el subconjunto de los hombres se puede apreciar un valor mínimo de 94 y un máximo de 192 siendo que menor el rango que el de las mujeres por 8, donde su rango es de 98. Presentando valores atípicos despues del tercer quartil y un segundo cuartil de 131 indicando la mitad de los datos. 

```{r sum_trestbps_pac, echo=FALSE, results='asis'}
# --- trestbps --- 
boxplot(heart_data$trestbps,
  main = "Presión Arterial en Pacientes",
  xlab = "Presión Arterial",
  ylab = "General",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```

**Notas:** Por último, en el conjunto general se puede ver un valor mínimo de 94 y un máximo de 200 con un rango de 106. Presentando valores atípicos después del tercer cuartil y un segundo cuartil de 130. 


## Medidas de Tendencia Central
Las medidas de tendencia central permiten obtener indicadores preeliminares que brindan una interpretación numérica de las medidas obtenidas.

### Media
Primer momento alrededor del cero es la media o valor esperado de la variable aleatoria y se denota por $\mu$. La media de una variable aleatoria se considera como una cantidad numérica alrededor de la cual los valores de la variable aleatoria tienden a agruparse. Por lo tanto, la media es una medida de tendencia central. Para el cálculo de la media se utiliza:

$$\bar{x}=\frac{1}{n}\sum_{i=1}^n x_i$$


### Mediana
La mediana en un conjunto de datos es el valor medio cuando los valores son ordenados de manera ascendente o descendente. Igualmente, en este punto será calculada la mediana para futuras referencias, si $n$ es par entonces se calcula mediante:

$$\tilde{x} = x_{(n + 1)/2}$$

Por otro lado si $n$ es impar se calcula:

$$\tilde{x} = x_{(n + 1)/2} +  x_{n/2}$$

### Conclusiones Generales
Para concluir las medidas de tendencia central se mostrará un histograma de frecuencias el cual contendrá un diagrama de densidad, que nos permite ver la inclinación de la curva, el promedio o media de los datos, la mediana y la desviación estándar como medida de referencia.

#### Colesterol

```{r mean_chol_women, echo=FALSE, results='asis'}
# --- trestbps --- 
hist(women_chol$chol, # histogram
col = "gray", # column color
border = "black", 
prob = TRUE, # show densities instead of frequencies
xlab = "Colesterol",
main = "Colesterol en Mujeres")


abline(v = mean(women_chol$chol),
 col = "royalblue",
 lwd = 2)


abline(v = median(women_chol$chol),
 col = "red",
 lwd = 2)

legend(x = "topright", # location of legend within plot area
 c("Promedio", "Mediana"),
 col = c("royalblue", "red"),
 lwd = c(2, 2, 2))
```

```{r mean_chol_men, echo=FALSE, results='asis'}
# --- trestbps --- 
hist(men_chol$chol, # histogram
col = "gray", # column color
border = "black", 
prob = TRUE, # show densities instead of frequencies
xlab = "Colesterol",
main = "Colesterol en Hombres")


abline(v = mean(men_chol$chol),
 col = "royalblue",
 lwd = 2)


abline(v = median(men_chol$chol),
 col = "red",
 lwd = 2)


legend(x = "topright", # location of legend within plot area
 c("Promedio", "Mediana"),
 col = c("royalblue", "red"),
 lwd = c(2, 2, 2))
```


```{r mean_chol_pac, echo=FALSE, results='asis'}
# --- trestbps --- 
hist(heart_data$chol, # histogram
col = "gray", # column color
border = "black", 
prob = TRUE, # show densities instead of frequencies
xlab = "Colesterol",
main = "Colesterol en Pacientes")



abline(v = mean(heart_data$chol),
 col = "royalblue",
 lwd = 2)


abline(v = median(heart_data$chol),
 col = "red",
 lwd = 2)


legend(x = "topright", # location of legend within plot area
 c("Promedio", "Mediana"),
 col = c("royalblue", "red"),
 lwd = c(2, 2, 2))
```







## Medidas de Dispersión

### Desviación Media


### Varianza
El segundo momento central,alrededor de la media, recibe el nombre de varianza de la variable aleatoria. La varianza de una variable aleatoria es una medida de la dispersión de la distribución de probabilidad de esta. La varianza puede representarse mediante la siguiente fórmula:

$$s^{2}=\frac{1}{N-1}\sum_{i=1}^N(x_i-\bar{x})^2$$

### Desviación Estándar

Y a su vez, se puede calcular la desviación estándar mediante:
$$s=\sqrt{\frac{1}{N-1}\sum_{i=1}^N(x_i-\bar{x})^2}$$
O bien:
$$s=\sqrt{s^2}$$

### Coeficiente de Variación

### Conclusiones Generales

#### Ritmo Cardiáco Máximo Alcanzado
```{r mean_thalach_women, echo=FALSE, results='asis'}
# --- trestbps --- 
hist(women_thalach$thalach, # histogram
col = "gray", # column color
border = "black", 
prob = TRUE, # show densities instead of frequencies
xlab = "Ritmo Cardiaco Máximo Alcanzado",
main = "Ritmo Cardiaco Máximo Alcanzado en Mujeres")

lines(density(women_thalach$thalach), # density plot
lwd = 2, # thickness of line
col = "orange")

abline(v = mean(women_thalach$thalach),
 col = "royalblue",
 lwd = 2)


abline(v = median(women_thalach$thalach),
 col = "red",
 lwd = 2)

abline(v = mean(women_thalach$thalach) + sd(women_thalach$thalach),
 col = "cyan",
 lwd = 2)

abline(v = mean(women_thalach$thalach) - sd(women_thalach$thalach),
 col = "cyan",
 lwd = 2)

legend(x = "topleft", # location of legend within plot area
 c("Diagrama de Densidad", "Promedio", "Mediana", "Desviación Estándar"),
 col = c("orange", "royalblue", "red", "cyan"),
 lwd = c(2, 2, 2))
```


```{r mean_thalach_men, echo=FALSE, results='asis'}
# --- trestbps --- 
hist(men_thalach$thalach, # histogram
col = "gray", # column color
border = "black", 
prob = TRUE, # show densities instead of frequencies
xlab = "Ritmo Cardiaco Máximo Alcanzado",
main = "Ritmo Cardiaco Máximo Alcanzado en Hombres")

lines(density(men_thalach$thalach), # density plot
lwd = 2, # thickness of line
col = "orange")

abline(v = mean(men_thalach$thalach),
 col = "royalblue",
 lwd = 2)


abline(v = median(men_thalach$thalach),
 col = "red",
 lwd = 2)

abline(v = mean(men_thalach$thalach) + sd(men_thalach$thalach),
 col = "cyan",
 lwd = 2)

abline(v = mean(men_thalach$thalach) - sd(men_thalach$thalach),
 col = "cyan",
 lwd = 2)

legend(x = "topleft", # location of legend within plot area
 c("Diagrama de Densidad", "Promedio", "Mediana", "Desviación Estándar"),
 col = c("orange", "royalblue", "red", "cyan"),
 lwd = c(2, 2, 2))
```


```{r mean_thalach_pac, echo=FALSE, results='asis'}
# --- trestbps --- 
hist(heart_data$thalach, # histogram
col = "gray", # column color
border = "black", 
prob = TRUE, # show densities instead of frequencies
xlab = "Ritmo Cardiaco Máximo Alcanzado",
main = "Ritmo Cardiaco Máximo Alcanzado en Pacientes")

lines(density(heart_data$thalach), # density plot
lwd = 2, # thickness of line
col = "orange")

abline(v = mean(heart_data$thalach),
 col = "royalblue",
 lwd = 2)


abline(v = median(heart_data$thalach),
 col = "red",
 lwd = 2)

abline(v = mean(heart_data$thalach) + sd(heart_data$thalach),
 col = "cyan",
 lwd = 2)

abline(v = mean(heart_data$thalach) - sd(heart_data$thalach),
 col = "cyan",
 lwd = 2)

legend(x = "topleft", # location of legend within plot area
 c("Diagrama de Densidad", "Promedio", "Mediana", "Desviación Estándar"),
 col = c("orange", "royalblue", "red", "cyan"),
 lwd = c(2, 2, 2))
```

